"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[921],{4302:(e,t,r)=>{r.d(t,{NN:()=>eG,iX:()=>eX,Br:()=>eQ});var i,s,n=/^[a-zA-Z:_][a-zA-Z0-9:_.-]*$/,a={revert:function(){}},o=new Map,u=new Set;function l(e){var t=o.get(e);return t||(t={element:e,attributes:{}},o.set(e,t)),t}function c(e,t,r,i,s){var n=r(e),a={isDirty:!1,originalValue:n,virtualValue:n,mutations:[],el:e,_positionTimeout:null,observer:new MutationObserver(function(){if("position"!==t||!a._positionTimeout){"position"===t&&(a._positionTimeout=setTimeout(function(){a._positionTimeout=null},1e3));var i=r(e);("position"!==t||i.parentNode!==a.virtualValue.parentNode||i.insertBeforeNode!==a.virtualValue.insertBeforeNode)&&i!==a.virtualValue&&(a.originalValue=i,s(a))}}),mutationRunner:s,setValue:i,getCurrentValue:r};return"position"===t&&e.parentNode?a.observer.observe(e.parentNode,{childList:!0,subtree:!0,attributes:!1,characterData:!1}):a.observer.observe(e,"html"===t?{childList:!0,subtree:!0,attributes:!0,characterData:!0}:{childList:!1,subtree:!1,attributes:!0,attributeFilter:[t]}),a}function d(e,t){var r=t.getCurrentValue(t.el);t.virtualValue=e,e&&"string"!=typeof e?r&&e.parentNode===r.parentNode&&e.insertBeforeNode===r.insertBeforeNode||(t.isDirty=!0,B()):e!==r&&(t.isDirty=!0,B())}function h(e){var t,r=e.originalValue;e.mutations.forEach(function(e){return r=e.mutate(r)}),d((t=r,i||(i=document.createElement("div")),i.innerHTML=t,i.innerHTML),e)}function f(e){var t=new Set(e.originalValue.split(/\s+/).filter(Boolean));e.mutations.forEach(function(e){return e.mutate(t)}),d(Array.from(t).filter(Boolean).join(" "),e)}function p(e){var t=e.originalValue;e.mutations.forEach(function(e){return t=e.mutate(t)}),d(t,e)}function g(e){var t=e.originalValue;e.mutations.forEach(function(e){t=function(e){var t=e.parentSelector,r=e.insertBeforeSelector,i=document.querySelector(t);if(!i)return null;var s=r?document.querySelector(r):null;return r&&!s?null:{parentNode:i,insertBeforeNode:s}}(e.mutate())||t}),d(t,e)}var m=function(e){return e.innerHTML},y=function(e,t){return e.innerHTML=t};function v(e){var t=l(e);return t.html||(t.html=c(e,"html",m,y,h)),t.html}var b=function(e){return{parentNode:e.parentElement,insertBeforeNode:e.nextElementSibling}},k=function(e,t){(!t.insertBeforeNode||t.parentNode.contains(t.insertBeforeNode))&&t.parentNode.insertBefore(e,t.insertBeforeNode)};function _(e){var t=l(e);return t.position||(t.position=c(e,"position",b,k,g)),t.position}var A=function(e,t){return t?e.className=t:e.removeAttribute("class")},E=function(e){return e.className};function w(e){var t=l(e);return t.classes||(t.classes=c(e,"class",E,A,f)),t.classes}function x(e,t){var r=l(e);return r.attributes[t]||(r.attributes[t]=c(e,t,function(e){var r;return null!=(r=e.getAttribute(t))?r:null},function(e,r){return null!==r?e.setAttribute(t,r):e.removeAttribute(t)},p)),r.attributes[t]}function S(e,t,r){if(r.isDirty){r.isDirty=!1;var i,s,n,a,u,l,c,d,h,f,p=r.virtualValue;!r.mutations.length&&(f=o.get(e))&&("html"===t?(null==(i=f.html)||null==(s=i.observer)||s.disconnect(),delete f.html):"class"===t?(null==(n=f.classes)||null==(a=n.observer)||a.disconnect(),delete f.classes):"position"===t?(null==(u=f.position)||null==(l=u.observer)||l.disconnect(),delete f.position):(null==(c=f.attributes)||null==(d=c[t])||null==(h=d.observer)||h.disconnect(),delete f.attributes[t])),r.setValue(e,p)}}function C(e,t){e.html&&S(t,"html",e.html),e.classes&&S(t,"class",e.classes),e.position&&S(t,"position",e.position),Object.keys(e.attributes).forEach(function(r){S(t,r,e.attributes[r])})}function B(){o.forEach(C)}function D(e){if("position"!==e.kind||1!==e.elements.size){var t=new Set(e.elements);document.querySelectorAll(e.selector).forEach(function(r){if(!t.has(r)){var i;e.elements.add(r),i=null,"html"===e.kind?i=v(r):"class"===e.kind?i=w(r):"attribute"===e.kind?i=x(r,e.attribute):"position"===e.kind&&(i=_(r)),i&&(i.mutations.push(e),i.mutationRunner(i))}})}}function F(){u.forEach(D)}function V(e){return"undefined"==typeof document?a:(u.add(e),D(e),{revert:function(){e.elements.forEach(function(t){var r=null;if("html"===e.kind?r=v(t):"class"===e.kind?r=w(t):"attribute"===e.kind?r=x(t,e.attribute):"position"===e.kind&&(r=_(t)),r){var i=r.mutations.indexOf(e);-1!==i&&r.mutations.splice(i,1),r.mutationRunner(r)}}),e.elements.clear(),u.delete(e)}})}function T(e,t){return V({kind:"html",elements:new Set,mutate:t,selector:e})}function $(e,t){return V({kind:"class",elements:new Set,mutate:t,selector:e})}function L(e,t,r){return n.test(t)?"class"===t||"className"===t?$(e,function(e){var t=r(Array.from(e).join(" "));e.clear(),t&&t.split(/\s+/g).filter(Boolean).forEach(function(t){return e.add(t)})}):V({kind:"attribute",attribute:t,elements:new Set,mutate:r,selector:e}):a}"undefined"!=typeof document&&(s||(s=new MutationObserver(function(){F()})),F(),s.observe(document.documentElement,{childList:!0,subtree:!0,attributes:!1,characterData:!1}));let R={declarative:function(e){var t,r,i=e.selector,s=e.action,n=e.value,o=e.attribute,u=e.parentSelector,l=e.insertBeforeSelector;if("html"===o){if("append"===s)return T(i,function(e){return e+(null!=n?n:"")});else if("set"===s)return T(i,function(){return null!=n?n:""})}else if("class"===o){if("append"===s)return $(i,function(e){n&&e.add(n)});else if("remove"===s)return $(i,function(e){n&&e.delete(n)});else if("set"===s)return $(i,function(e){e.clear(),n&&e.add(n)})}else if("position"===o){if("set"===s&&u){return t=i,r=function(){return{insertBeforeSelector:l,parentSelector:u}},V({kind:"position",elements:new Set,mutate:r,selector:t})}}else if("append"===s)return L(i,o,function(e){return null!==e?e+(null!=n?n:""):null!=n?n:""});else if("set"===s)return L(i,o,function(){return null!=n?n:""});else if("remove"===s)return L(i,o,function(){return null});return a}},I={fetch:globalThis.fetch?globalThis.fetch.bind(globalThis):void 0,SubtleCrypto:globalThis.crypto?globalThis.crypto.subtle:void 0,EventSource:globalThis.EventSource};function N(e){let t=0x811c9dc5,r=e.length;for(let i=0;i<r;i++)t^=e.charCodeAt(i),t+=(t<<1)+(t<<4)+(t<<7)+(t<<8)+(t<<24);return t>>>0}function M(e,t,r){return 2===r?N(N(e+t)+"")%1e4/1e4:1===r?N(t+e)%1e3/1e3:null}function U(e,t){return e>=t[0]&&e<t[1]}function O(e){try{let t=e.replace(/([^\\])\//g,"$1\\/");return new RegExp(t)}catch(e){console.error(e);return}}function P(e,t){if(!t.length)return!1;let r=!1,i=!1;for(let s=0;s<t.length;s++){let n=function(e,t,r){try{let i=new URL(e,"https://_");if("regex"===t){let e=O(r);if(!e)return!1;return e.test(i.href)||e.test(i.href.substring(i.origin.length))}if("simple"===t)try{let e=new URL(r.replace(/^([^:/?]*)\./i,"https://$1.").replace(/\*/g,"_____"),"https://_____"),t=[[i.host,e.host,!1],[i.pathname,e.pathname,!0]];return e.hash&&t.push([i.hash,e.hash,!1]),e.searchParams.forEach((e,r)=>{t.push([i.searchParams.get(r)||"",e,!1])}),!t.some(e=>!function(e,t,r){try{let i=t.replace(/[*.+?^${}()|[\]\\]/g,"\\$&").replace(/_____/g,".*");return r&&(i="\\/?"+i.replace(/(^\/|\/$)/g,"")+"\\/?"),RegExp("^"+i+"$","i").test(e)}catch(e){return!1}}(e[0],e[1],e[2]))}catch(e){}return!1}catch(e){return!1}}(e,t[s].type,t[s].pattern);if(!1===t[s].include){if(n)return!1}else r=!0,n&&(i=!0)}return i||!r}let K=e=>Uint8Array.from(atob(e),e=>e.charCodeAt(0));async function j(e,t,r){if(t=t||"",!(r=r||globalThis.crypto&&globalThis.crypto.subtle||I.SubtleCrypto))throw Error("No SubtleCrypto implementation found");try{let i=await r.importKey("raw",K(t),{name:"AES-CBC",length:128},!0,["encrypt","decrypt"]),[s,n]=e.split("."),a=await r.decrypt({name:"AES-CBC",iv:K(s)},i,K(n));return new TextDecoder().decode(a)}catch(e){throw Error("Failed to decrypt")}}function H(e){return"string"==typeof e?e:JSON.stringify(e)}function q(e){"number"==typeof e&&(e+=""),e&&"string"==typeof e||(e="0");let t=e.replace(/(^v|\+.*$)/g,"").split(/[-.]/);return 3===t.length&&t.push("~"),t.map(e=>e.match(/^[0-9]+$/)?e.padStart(5," "):e).join("-")}function J(e){return"object"==typeof e&&null!==e}function G(e){return e.urlPatterns&&e.variations.some(e=>J(e)&&"urlRedirect"in e)?"redirect":e.variations.some(e=>J(e)&&(e.domMutations||"js"in e||"css"in e))?"visual":"unknown"}async function z(e,t){return new Promise(r=>{let i,s=!1,n=e=>{s||(s=!0,i&&clearTimeout(i),r(e||null))};t&&(i=setTimeout(()=>n(),t)),e.then(e=>n(e)).catch(()=>n())})}let Z={staleTTL:6e4,maxAge:144e5,cacheKey:"gbFeaturesCache",backgroundSync:!0,maxEntries:10,disableIdleStreams:!1,idleStreamInterval:2e4,disableCache:!1},Q={fetchFeaturesCall:({host:e,clientKey:t,headers:r})=>I.fetch(`${e}/api/features/${t}`,{headers:r}),fetchRemoteEvalCall:({host:e,clientKey:t,payload:r,headers:i})=>{let s={method:"POST",headers:{"Content-Type":"application/json",...i},body:JSON.stringify(r)};return I.fetch(`${e}/api/eval/${t}`,s)},eventSourceCall:({host:e,clientKey:t,headers:r})=>r?new I.EventSource(`${e}/sub/${t}`,{headers:r}):new I.EventSource(`${e}/sub/${t}`),startIdleListener:()=>{let e;if("undefined"==typeof window||"undefined"==typeof document)return;let t=()=>{"visible"===document.visibilityState?(window.clearTimeout(e),et.forEach(e=>{e&&"idle"===e.state&&ey(e)})):"hidden"===document.visibilityState&&(e=window.setTimeout(es,Z.idleStreamInterval))};return document.addEventListener("visibilitychange",t),()=>document.removeEventListener("visibilitychange",t)},stopIdleListener:()=>{}};try{globalThis.localStorage&&(I.localStorage=globalThis.localStorage)}catch(e){}let X=new Map,W=!1,Y=new Map,ee=new Map,et=new Map,er=new Set;async function ei({instance:e,timeout:t,skipCache:r,allowStale:i,backgroundSync:s}){return s||(Z.backgroundSync=!1),ea({instance:e,allowStale:i,timeout:t,skipCache:r})}function es(){et.forEach(e=>{e&&(e.state="idle",em(e))})}async function en(){try{if(!I.localStorage)return;await I.localStorage.setItem(Z.cacheKey,JSON.stringify(Array.from(Y.entries())))}catch(e){}}async function ea({instance:e,allowStale:t,timeout:r,skipCache:i}){let s=eo(e),n=eu(e),a=new Date,o=new Date(a.getTime()-Z.maxAge+Z.staleTTL);await el();let u=Z.disableCache||i?void 0:Y.get(n);return u&&(t||u.staleAt>a)&&u.staleAt>o?(u.sse&&er.add(s),u.staleAt<a?ef(e):ep(e),{data:u.data,success:!0,source:"cache"}):await z(ef(e),r)||{data:null,success:!1,source:"timeout",error:Error("Timeout")}}function eo(e){let[t,r]=e.getApiInfo();return`${t}||${r}`}function eu(e){let t=eo(e);if(!("isRemoteEval"in e)||!e.isRemoteEval())return t;let r=e.getAttributes(),i=e.getCacheKeyAttributes()||Object.keys(e.getAttributes()),s={};i.forEach(e=>{s[e]=r[e]});let n=e.getForcedVariations(),a=e.getUrl();return`${t}||${JSON.stringify({ca:s,fv:n,url:a})}`}async function el(){if(!W){W=!0;try{if(I.localStorage){let e=await I.localStorage.getItem(Z.cacheKey);if(!Z.disableCache&&e){let t=JSON.parse(e);t&&Array.isArray(t)&&t.forEach(([e,t])=>{Y.set(e,{...t,staleAt:new Date(t.staleAt)})}),ec()}}}catch(e){}if(!Z.disableIdleStreams){let e=Q.startIdleListener();e&&(Q.stopIdleListener=e)}}}function ec(){let e=Array.from(Y.entries()).map(([e,t])=>({key:e,staleAt:t.staleAt.getTime()})).sort((e,t)=>e.staleAt-t.staleAt),t=Math.min(Math.max(0,Y.size-Z.maxEntries),Y.size);for(let r=0;r<t;r++)Y.delete(e[r].key)}function ed(e,t,r){let i=r.dateUpdated||"",s=new Date(Date.now()+Z.staleTTL),n=Z.disableCache?void 0:Y.get(t);if(n&&i&&n.version===i){n.staleAt=s,en();return}Z.disableCache||(Y.set(t,{data:r,version:i,staleAt:s,sse:er.has(e)}),ec()),en();let a=X.get(e);a&&a.forEach(e=>eh(e,r))}async function eh(e,t){await e.setPayload(t||e.getPayload())}async function ef(e){let{apiHost:t,apiRequestHeaders:r}=e.getApiHosts(),i=e.getClientKey(),s="isRemoteEval"in e&&e.isRemoteEval(),n=eo(e),a=eu(e),o=ee.get(a);return o||(o=(s?Q.fetchRemoteEvalCall({host:t,clientKey:i,payload:{attributes:e.getAttributes(),forcedVariations:e.getForcedVariations(),forcedFeatures:Array.from(e.getForcedFeatures().entries()),url:e.getUrl()},headers:r}):Q.fetchFeaturesCall({host:t,clientKey:i,headers:r})).then(e=>{if(!e.ok)throw Error(`HTTP error: ${e.status}`);return"enabled"===e.headers.get("x-sse-support")&&er.add(n),e.json()}).then(t=>(ed(n,a,t),ep(e),ee.delete(a),{data:t,success:!0,source:"network"})).catch(e=>(ee.delete(a),{data:null,source:"error",success:!1,error:e})),ee.set(a,o)),o}function ep(e,t=!1){let r=eo(e),i=eu(e),{streamingHost:s,streamingHostRequestHeaders:n}=e.getApiHosts(),a=e.getClientKey();if(t&&er.add(r),Z.backgroundSync&&er.has(r)&&I.EventSource){if(et.has(r))return;let e={src:null,host:s,clientKey:a,headers:n,cb:t=>{try{if("features-updated"===t.type){let e=X.get(r);e&&e.forEach(e=>{ef(e)})}else if("features"===t.type){let e=JSON.parse(t.data);ed(r,i,e)}e.errors=0}catch(t){eg(e)}},errors:0,state:"active"};et.set(r,e),ey(e)}}function eg(e){if("idle"!==e.state&&(e.errors++,e.errors>3||e.src&&2===e.src.readyState)){let t=Math.pow(3,e.errors-3)*(1e3+1e3*Math.random());em(e),setTimeout(()=>{["idle","active"].includes(e.state)||ey(e)},Math.min(t,3e5))}}function em(e){e.src&&(e.src.onopen=null,e.src.onerror=null,e.src.close(),e.src=null,"active"===e.state&&(e.state="disabled"))}function ey(e){e.src=Q.eventSourceCall({host:e.host,clientKey:e.clientKey,headers:e.headers}),e.state="active",e.src.addEventListener("features",e.cb),e.src.addEventListener("features-updated",e.cb),e.src.onerror=()=>eg(e),e.src.onopen=()=>{e.errors=0}}function ev(e,t){em(e),et.delete(t)}function eb(){er.clear(),et.forEach(ev),X.clear(),Q.stopIdleListener()}function ek(e,t){if(t.streaming){if(!e.getClientKey())throw Error("Must specify clientKey to enable streaming");t.payload&&ep(e,!0);let r=eo(e),i=X.get(r)||new Set;i.add(e),X.set(r,i)}}let e_={};function eA(e,t,r){for(let[i,s]of(r=r||{},Object.entries(t)))switch(i){case"$or":if(!eB(e,s,r))return!1;break;case"$nor":if(eB(e,s,r))return!1;break;case"$and":if(!function(e,t,r){for(let i=0;i<t.length;i++)if(!eA(e,t[i],r))return!1;return!0}(e,s,r))return!1;break;case"$not":if(eA(e,s,r))return!1;break;default:if(!ew(s,function(e,t){let r=t.split("."),i=e;for(let e=0;e<r.length;e++)if(!i||"object"!=typeof i||!(r[e]in i))return null;else i=i[r[e]];return i}(e,i),r))return!1}return!0}function eE(e,t=!1){let r=`${e}${t?"/i":""}`;return e_[r]||(e_[r]=new RegExp(e.replace(/([^\\])\//g,"$1\\/"),t?"i":void 0)),e_[r]}function ew(e,t,r,i=!1){if("string"==typeof e)return i?String(t).toLowerCase()===e.toLowerCase():t+""===e;if("number"==typeof e)return+t===e;if("boolean"==typeof e)return null!==t&&!!t===e;if(null===e)return null===t;if(Array.isArray(e)||!ex(e))return JSON.stringify(t)===JSON.stringify(e);for(let i in e)if(!function(e,t,r,i){switch(e){case"$veq":return q(t)===q(r);case"$vne":return q(t)!==q(r);case"$vgt":return q(t)>q(r);case"$vgte":return q(t)>=q(r);case"$vlt":return q(t)<q(r);case"$vlte":return q(t)<=q(r);case"$eq":return t===r;case"$ne":return t!==r;case"$lt":return t<r;case"$lte":return t<=r;case"$gt":return t>r;case"$gte":return t>=r;case"$exists":return r?null!=t:null==t;case"$in":if(!Array.isArray(r))return!1;return eS(t,r);case"$ini":if(!Array.isArray(r))return!1;return eS(t,r,!0);case"$inGroup":return eS(t,i[r]||[]);case"$notInGroup":return!eS(t,i[r]||[]);case"$nin":if(!Array.isArray(r))return!1;return!eS(t,r);case"$nini":if(!Array.isArray(r))return!1;return!eS(t,r,!0);case"$not":return!ew(r,t,i);case"$size":if(!Array.isArray(t))return!1;return ew(r,t.length,i);case"$elemMatch":if(!Array.isArray(t))return!1;let s=ex(r)?e=>ew(r,e,i):e=>eA(e,r,i);for(let e=0;e<t.length;e++)if(t[e]&&s(t[e]))return!0;return!1;case"$all":if(!Array.isArray(r))return!1;return eC(t,r,i);case"$alli":if(!Array.isArray(r))return!1;return eC(t,r,i,!0);case"$regex":try{return eE(r).test(t)}catch(e){return!1}case"$regexi":try{return eE(r,!0).test(t)}catch(e){return!1}case"$type":return function(e){if(null===e)return"null";if(Array.isArray(e))return"array";let t=typeof e;return["string","number","boolean","object","undefined"].includes(t)?t:"unknown"}(t)===r;default:return console.error("Unknown operator: "+e),!1}}(i,t,e[i],r))return!1;return!0}function ex(e){let t=Object.keys(e);return t.length>0&&t.filter(e=>"$"===e[0]).length===t.length}function eS(e,t,r=!1){if(r){let r=e=>"string"==typeof e?e.toLowerCase():e;return Array.isArray(e)?e.some(e=>t.some(t=>r(e)===r(t))):t.some(t=>r(e)===r(t))}return Array.isArray(e)?e.some(e=>t.includes(e)):t.includes(e)}function eC(e,t,r,i=!1){if(!Array.isArray(e))return!1;for(let s=0;s<t.length;s++){let n=!1;for(let a=0;a<e.length;a++)if(ew(t[s],e[a],r,i)){n=!0;break}if(!n)return!1}return!0}function eB(e,t,r){if(!t.length)return!0;for(let i=0;i<t.length;i++)if(eA(e,t[i],r))return!0;return!1}async function eD(e){try{await e()}catch(e){}}function eF(e,t,r){if(e.user.trackedExperiments){let i=eH(t,r);if(e.user.trackedExperiments.has(i))return[];e.user.trackedExperiments.add(i)}e.user.enableDevMode&&e.user.devLogs&&e.user.devLogs.push({experiment:t,result:r,timestamp:Date.now().toString(),logType:"experiment"});let i=[];if(e.global.trackingCallback){let s=e.global.trackingCallback;i.push(eD(()=>s(t,r,e.user)))}if(e.user.trackingCallback){let s=e.user.trackingCallback;i.push(eD(()=>s(t,r)))}if(e.global.eventLogger){let s=e.global.eventLogger;i.push(eD(()=>s("Experiment Viewed",{experimentId:t.key,variationId:r.key,hashAttribute:r.hashAttribute,hashValue:r.hashValue},e.user)))}return i}function eV(e,t){if(t.stack.evaluatedFeatures.has(e))return e$(t,e,null,"cyclicPrerequisite");t.stack.evaluatedFeatures.add(e),t.stack.id=e;let r=function(e){let t=new Map;return e.global.forcedFeatureValues&&e.global.forcedFeatureValues.forEach((e,r)=>t.set(r,e)),e.user.forcedFeatureValues&&e.user.forcedFeatureValues.forEach((e,r)=>t.set(r,e)),t}(t);if(r.has(e))return e$(t,e,r.get(e),"override");if(!t.global.features||!t.global.features[e])return e$(t,e,null,"unknownFeature");let i=t.global.features[e];if(i.rules){let r=new Set(t.stack.evaluatedFeatures);e:for(let s of i.rules){if(s.parentConditions)for(let i of s.parentConditions){t.stack.evaluatedFeatures=new Set(r);let s=eV(i.id,t);if("cyclicPrerequisite"===s.source)return e$(t,e,null,"cyclicPrerequisite");if(!eA({value:s.value},i.condition||{})){if(i.gate)return e$(t,e,null,"prerequisite");continue e}}if(s.filters&&eI(s.filters,t))continue;if("force"in s){if(s.condition&&!eR(s.condition,t)||!function(e,t,r,i,s,n,a){if(!s&&void 0===n)return!0;if(!s&&0===n)return!1;let{hashValue:o}=eM(e,r,i);if(!o)return!1;let u=M(t,o,a||1);return null!==u&&(s?U(u,s):void 0===n||u<=n)}(t,s.seed||e,s.hashAttribute,t.user.saveStickyBucketAssignmentDoc&&!s.disableStickyBucketing?s.fallbackAttribute:void 0,s.range,s.coverage,s.hashVersion))continue;return s.tracks&&s.tracks.forEach(e=>{!eF(t,e.experiment,e.result).length&&t.global.saveDeferredTrack&&t.global.saveDeferredTrack({experiment:e.experiment,result:e.result})}),e$(t,e,s.force,"force",s.id)}if(!s.variations)continue;let i={variations:s.variations,key:s.key||e};"coverage"in s&&(i.coverage=s.coverage),s.weights&&(i.weights=s.weights),s.hashAttribute&&(i.hashAttribute=s.hashAttribute),s.fallbackAttribute&&(i.fallbackAttribute=s.fallbackAttribute),s.disableStickyBucketing&&(i.disableStickyBucketing=s.disableStickyBucketing),void 0!==s.bucketVersion&&(i.bucketVersion=s.bucketVersion),void 0!==s.minBucketVersion&&(i.minBucketVersion=s.minBucketVersion),s.namespace&&(i.namespace=s.namespace),s.meta&&(i.meta=s.meta),s.ranges&&(i.ranges=s.ranges),s.name&&(i.name=s.name),s.phase&&(i.phase=s.phase),s.seed&&(i.seed=s.seed),s.hashVersion&&(i.hashVersion=s.hashVersion),s.filters&&(i.filters=s.filters),s.condition&&(i.condition=s.condition);let{result:n}=eT(i,e,t);if(t.global.onExperimentEval&&t.global.onExperimentEval(i,n),n.inExperiment&&!n.passthrough)return e$(t,e,n.value,"experiment",s.id,i,n)}}return e$(t,e,void 0===i.defaultValue?null:i.defaultValue,"defaultValue")}function eT(e,t,r){var i;let s=e.key,n=e.variations.length;if(n<2||!1===r.global.enabled||!1===r.user.enabled||(e=function(e,t){let r=e.key,i=t.global.overrides;return i&&i[r]&&"string"==typeof(e=Object.assign({},e,i[r])).url&&(e.url=O(e.url)),e}(e,r)).urlPatterns&&!P(r.user.url||"",e.urlPatterns))return{result:eN(r,e,-1,!1,t)};let a=function(e,t,r){if(!t)return null;let i=t.split("?")[1];if(!i)return null;let s=i.replace(/#.*/,"").split("&").map(e=>e.split("=",2)).filter(([t])=>t===e).map(([,e])=>parseInt(e));return s.length>0&&s[0]>=0&&s[0]<r?s[0]:null}(s,r.user.url||"",n);if(null!==a)return{result:eN(r,e,a,!1,t)};let o=(i=r).global.forcedVariations&&i.user.forcedVariations?{...i.global.forcedVariations,...i.user.forcedVariations}:i.global.forcedVariations?i.global.forcedVariations:i.user.forcedVariations?i.user.forcedVariations:{};if(s in o)return{result:eN(r,e,o[s],!1,t)};if("draft"===e.status||!1===e.active)return{result:eN(r,e,-1,!1,t)};let{hashAttribute:u,hashValue:l}=eM(r,e.hashAttribute,r.user.saveStickyBucketAssignmentDoc&&!e.disableStickyBucketing?e.fallbackAttribute:void 0);if(!l)return{result:eN(r,e,-1,!1,t)};let c=-1,d=!1,h=!1;if(r.user.saveStickyBucketAssignmentDoc&&!e.disableStickyBucketing){let{variation:t,versionIsBlocked:i}=function({ctx:e,expKey:t,expBucketVersion:r,expHashAttribute:i,expFallbackAttribute:s,expMinBucketVersion:n,expMeta:a}){n=n||0,i=i||"id",a=a||[];let o=eU(t,r=r||0),u=function(e,t,r){if(!e.user.stickyBucketAssignmentDocs)return{};let{hashAttribute:i,hashValue:s}=eM(e,t),n=eO(i,H(s)),{hashAttribute:a,hashValue:o}=eM(e,r),u=o?eO(a,H(o)):null,l={};return u&&e.user.stickyBucketAssignmentDocs[u]&&Object.assign(l,e.user.stickyBucketAssignmentDocs[u].assignments||{}),e.user.stickyBucketAssignmentDocs[n]&&Object.assign(l,e.user.stickyBucketAssignmentDocs[n].assignments||{}),l}(e,i,s);if(n>0){for(let e=0;e<n;e++)if(void 0!==u[eU(t,e)])return{variation:-1,versionIsBlocked:!0}}let l=u[o];if(void 0===l)return{variation:-1};let c=a.findIndex(e=>e.key===l);return c<0?{variation:-1}:{variation:c}}({ctx:r,expKey:e.key,expBucketVersion:e.bucketVersion,expHashAttribute:e.hashAttribute,expFallbackAttribute:e.fallbackAttribute,expMinBucketVersion:e.minBucketVersion,expMeta:e.meta});d=t>=0,c=t,h=!!i}if(!d){if(e.filters){if(eI(e.filters,r))return{result:eN(r,e,-1,!1,t)}}else if(e.namespace&&!function(e,t){let r=M("__"+t[0],e,1);return null!==r&&r>=t[1]&&r<t[2]}(l,e.namespace))return{result:eN(r,e,-1,!1,t)};if(e.include&&!function(e){try{return e()}catch(e){return console.error(e),!1}}(e.include)||e.condition&&!eR(e.condition,r))return{result:eN(r,e,-1,!1,t)};if(e.parentConditions){let i=new Set(r.stack.evaluatedFeatures);for(let s of e.parentConditions){r.stack.evaluatedFeatures=new Set(i);let n=eV(s.id,r);if("cyclicPrerequisite"===n.source||!eA({value:n.value},s.condition||{}))return{result:eN(r,e,-1,!1,t)}}}if(e.groups&&!function(e,t){let r=t.global.groups||{};for(let t=0;t<e.length;t++)if(r[e[t]])return!0;return!1}(e.groups,r))return{result:eN(r,e,-1,!1,t)}}if(e.url&&!function(e,t){let r=t.user.url;if(!r)return!1;let i=r.replace(/^https?:\/\//,"").replace(/^[^/]*\//,"/");return!!(e.test(r)||e.test(i))}(e.url,r))return{result:eN(r,e,-1,!1,t)};let f=M(e.seed||s,l,e.hashVersion||1);if(null===f)return{result:eN(r,e,-1,!1,t)};if(d||(c=function(e,t){for(let r=0;r<t.length;r++)if(U(e,t[r]))return r;return -1}(f,e.ranges||function(e,t,r){(t=void 0===t?1:t)<0?t=0:t>1&&(t=1);let i=e<=0?[]:Array(e).fill(1/e);(r=r||i).length!==e&&(r=i);let s=r.reduce((e,t)=>t+e,0);(s<.99||s>1.01)&&(r=i);let n=0;return r.map(e=>{let r=n;return n+=e,[r,r+t*e]})}(n,void 0===e.coverage?1:e.coverage,e.weights))),h)return{result:eN(r,e,-1,!1,t,void 0,!0)};if(c<0)return{result:eN(r,e,-1,!1,t)};if("force"in e)return{result:eN(r,e,void 0===e.force?-1:e.force,!1,t)};if(r.global.qaMode||r.user.qaMode||"stopped"===e.status)return{result:eN(r,e,-1,!1,t)};let p=eN(r,e,c,!0,t,f,d);if(r.user.saveStickyBucketAssignmentDoc&&!e.disableStickyBucketing){let{changed:t,key:i,doc:s}=function(e,t,r,i){let s=eO(t,r),n=e.user.stickyBucketAssignmentDocs&&e.user.stickyBucketAssignmentDocs[s]&&e.user.stickyBucketAssignmentDocs[s].assignments||{},a={...n,...i},o=JSON.stringify(n)!==JSON.stringify(a);return{key:s,doc:{attributeName:t,attributeValue:r,assignments:a},changed:o}}(r,u,H(l),{[eU(e.key,e.bucketVersion)]:p.key});t&&(r.user.stickyBucketAssignmentDocs=r.user.stickyBucketAssignmentDocs||{},r.user.stickyBucketAssignmentDocs[i]=s,r.user.saveStickyBucketAssignmentDoc(s))}let g=eF(r,e,p);0===g.length&&r.global.saveDeferredTrack&&r.global.saveDeferredTrack({experiment:e,result:p});let m=g.length?1===g.length?g[0]:Promise.all(g).then(()=>{}):void 0;return"changeId"in e&&e.changeId&&r.global.recordChangeId&&r.global.recordChangeId(e.changeId),{result:p,trackingCall:m}}function e$(e,t,r,i,s,n,a){let o={value:r,on:!!r,off:!r,source:i,ruleId:s||""};return n&&(o.experiment=n),a&&(o.experimentResult=a),"override"!==i&&function(e,t,r){if(e.user.trackedFeatureUsage){let i=JSON.stringify(r.value);if(e.user.trackedFeatureUsage[t]===i)return;e.user.trackedFeatureUsage[t]=i,e.user.enableDevMode&&e.user.devLogs&&e.user.devLogs.push({featureKey:t,result:r,timestamp:Date.now().toString(),logType:"feature"})}if(e.global.onFeatureUsage){let i=e.global.onFeatureUsage;eD(()=>i(t,r,e.user))}if(e.user.onFeatureUsage){let i=e.user.onFeatureUsage;eD(()=>i(t,r))}if(e.global.eventLogger){let i=e.global.eventLogger;eD(()=>i("Feature Evaluated",{feature:t,source:r.source,value:r.value,ruleId:"defaultValue"===r.source?"$default":r.ruleId||"",variationId:r.experimentResult?r.experimentResult.key:""},e.user))}}(e,t,o),o}function eL(e){return{...e.user.attributes,...e.user.attributeOverrides}}function eR(e,t){return eA(eL(t),e,t.global.savedGroups||{})}function eI(e,t){return e.some(e=>{let{hashValue:r}=eM(t,e.attribute);if(!r)return!0;let i=M(e.seed,r,e.hashVersion||2);return null===i||!e.ranges.some(e=>U(i,e))})}function eN(e,t,r,i,s,n,a){let o=!0;(r<0||r>=t.variations.length)&&(r=0,o=!1);let{hashAttribute:u,hashValue:l}=eM(e,t.hashAttribute,e.user.saveStickyBucketAssignmentDoc&&!t.disableStickyBucketing?t.fallbackAttribute:void 0),c=t.meta?t.meta[r]:{},d={key:c.key||""+r,featureId:s,inExperiment:o,hashUsed:i,variationId:r,value:t.variations[r],hashAttribute:u,hashValue:l,stickyBucketUsed:!!a};return c.name&&(d.name=c.name),void 0!==n&&(d.bucket=n),c.passthrough&&(d.passthrough=c.passthrough),d}function eM(e,t,r){let i=t||"id",s="",n=eL(e);return n[i]&&(s=n[i]),!s&&r&&(n[r]&&(s=n[r]),s&&(i=r)),{hashAttribute:i,hashValue:s}}function eU(e,t){return t=t||0,`${e}__${t}`}function eO(e,t){return`${e}||${t}`}async function eP(e,t,r){let i=eK(e,r);return t.getAllAssignments(i)}function eK(e,t){let r={};return(function(e,t){let r=new Set,i=t&&t.features?t.features:e.global.features||{},s=t&&t.experiments?t.experiments:e.global.experiments||[];return Object.keys(i).forEach(e=>{let t=i[e];if(t.rules)for(let e of t.rules)e.variations&&(r.add(e.hashAttribute||"id"),e.fallbackAttribute&&r.add(e.fallbackAttribute))}),s.map(e=>{r.add(e.hashAttribute||"id"),e.fallbackAttribute&&r.add(e.fallbackAttribute)}),Array.from(r)})(e,t).forEach(t=>{let{hashValue:i}=eM(e,t);r[t]=H(i)}),r}async function ej(e,t,r){if((e={...e}).encryptedFeatures){try{e.features=JSON.parse(await j(e.encryptedFeatures,t,r))}catch(e){console.error(e)}delete e.encryptedFeatures}if(e.encryptedExperiments){try{e.experiments=JSON.parse(await j(e.encryptedExperiments,t,r))}catch(e){console.error(e)}delete e.encryptedExperiments}if(e.encryptedSavedGroups){try{e.savedGroups=JSON.parse(await j(e.encryptedSavedGroups,t,r))}catch(e){console.error(e)}delete e.encryptedSavedGroups}return e}function eH(e,t){return t.hashAttribute+t.hashValue+e.key+t.variationId}let eq="undefined"!=typeof window&&"undefined"!=typeof document,eJ=function(){let e;try{e="1.6.4"}catch(t){e=""}return e}();class eG{constructor(e){if(e=e||{},this.version=eJ,this._options=this.context=e,this._renderer=e.renderer||null,this._trackedExperiments=new Set,this._completedChangeIds=new Set,this._trackedFeatures={},this.debug=!!e.debug,this._subscriptions=new Set,this.ready=!1,this._assigned=new Map,this._activeAutoExperiments=new Map,this._triggeredExpKeys=new Set,this._initialized=!1,this._redirectedUrl="",this._deferredTrackingCalls=new Map,this._autoExperimentsAllowed=!e.disableExperimentsOnLoad,this._destroyCallbacks=[],this.logs=[],this.log=this.log.bind(this),this._saveDeferredTrack=this._saveDeferredTrack.bind(this),this._onExperimentEval=this._onExperimentEval.bind(this),this._fireSubscriptions=this._fireSubscriptions.bind(this),this._recordChangedId=this._recordChangedId.bind(this),e.remoteEval){if(e.decryptionKey)throw Error("Encryption is not available for remoteEval");if(!e.clientKey)throw Error("Missing clientKey");let t=!1;try{t=!!new URL(e.apiHost||"").hostname.match(/growthbook\.io$/i)}catch(e){}if(t)throw Error("Cannot use remoteEval on GrowthBook Cloud")}else if(e.cacheKeyAttributes)throw Error("cacheKeyAttributes are only used for remoteEval");if(e.stickyBucketService){let t=e.stickyBucketService;this._saveStickyBucketAssignmentDoc=e=>t.saveAssignments(e)}if(e.plugins)for(let t of e.plugins)t(this);if(e.features&&(this.ready=!0),eq&&e.enableDevMode&&(window._growthbook=this,document.dispatchEvent(new Event("gbloaded"))),e.experiments&&(this.ready=!0,this._updateAllAutoExperiments()),this._options.stickyBucketService&&this._options.stickyBucketAssignmentDocs)for(let e in this._options.stickyBucketAssignmentDocs){let t=this._options.stickyBucketAssignmentDocs[e];t&&this._options.stickyBucketService.saveAssignments(t).catch(()=>{})}this.ready&&this.refreshStickyBuckets(this.getPayload())}async setPayload(e){this._payload=e;let t=await ej(e,this._options.decryptionKey);this._decryptedPayload=t,await this.refreshStickyBuckets(t),t.features&&(this._options.features=t.features),t.savedGroups&&(this._options.savedGroups=t.savedGroups),t.experiments&&(this._options.experiments=t.experiments,this._updateAllAutoExperiments()),this.ready=!0,this._render()}initSync(e){this._initialized=!0;let t=e.payload;if(t.encryptedExperiments||t.encryptedFeatures)throw Error("initSync does not support encrypted payloads");return this._options.stickyBucketService&&!this._options.stickyBucketAssignmentDocs&&(this._options.stickyBucketAssignmentDocs=this.generateStickyBucketAssignmentDocsSync(this._options.stickyBucketService,t)),this._payload=t,this._decryptedPayload=t,t.features&&(this._options.features=t.features),t.experiments&&(this._options.experiments=t.experiments,this._updateAllAutoExperiments()),this.ready=!0,ek(this,e),this}async init(e){if(this._initialized=!0,(e=e||{}).cacheSettings&&(Object.assign(Z,e.cacheSettings),Z.backgroundSync||eb()),e.payload)return await this.setPayload(e.payload),ek(this,e),{success:!0,source:"init"};{let{data:t,...r}=await this._refresh({...e,allowStale:!0});return ek(this,e),await this.setPayload(t||{}),r}}async loadFeatures(e){e=e||{},await this.init({skipCache:e.skipCache,timeout:e.timeout,streaming:(this._options.backgroundSync??!0)&&(e.autoRefresh||this._options.subscribeToChanges)})}async refreshFeatures(e){let t=await this._refresh({...e||{},allowStale:!1});t.data&&await this.setPayload(t.data)}getApiInfo(){return[this.getApiHosts().apiHost,this.getClientKey()]}getApiHosts(){var e=this._options;let t=e.apiHost||"https://cdn.growthbook.io";return{apiHost:t.replace(/\/*$/,""),streamingHost:(e.streamingHost||t).replace(/\/*$/,""),apiRequestHeaders:e.apiHostRequestHeaders,streamingHostRequestHeaders:e.streamingHostRequestHeaders}}getClientKey(){return this._options.clientKey||""}getPayload(){return this._payload||{features:this.getFeatures(),experiments:this.getExperiments()}}getDecryptedPayload(){return this._decryptedPayload||this.getPayload()}isRemoteEval(){return this._options.remoteEval||!1}getCacheKeyAttributes(){return this._options.cacheKeyAttributes}async _refresh({timeout:e,skipCache:t,allowStale:r,streaming:i}){if(!this._options.clientKey)throw Error("Missing clientKey");return ei({instance:this,timeout:e,skipCache:t||this._options.disableCache,allowStale:r,backgroundSync:i??this._options.backgroundSync??!0})}_render(){if(this._renderer)try{this._renderer()}catch(e){console.error("Failed to render",e)}}setFeatures(e){this._options.features=e,this.ready=!0,this._render()}async setEncryptedFeatures(e,t,r){let i=await j(e,t||this._options.decryptionKey,r);this.setFeatures(JSON.parse(i))}setExperiments(e){this._options.experiments=e,this.ready=!0,this._updateAllAutoExperiments()}async setEncryptedExperiments(e,t,r){let i=await j(e,t||this._options.decryptionKey,r);this.setExperiments(JSON.parse(i))}async setAttributes(e){if(this._options.attributes=e,this._options.stickyBucketService&&await this.refreshStickyBuckets(),this._options.remoteEval)return void await this._refreshForRemoteEval();this._render(),this._updateAllAutoExperiments()}async updateAttributes(e){return this.setAttributes({...this._options.attributes,...e})}async setAttributeOverrides(e){if(this._options.attributeOverrides=e,this._options.stickyBucketService&&await this.refreshStickyBuckets(),this._options.remoteEval)return void await this._refreshForRemoteEval();this._render(),this._updateAllAutoExperiments()}async setForcedVariations(e){if(this._options.forcedVariations=e||{},this._options.remoteEval)return void await this._refreshForRemoteEval();this._render(),this._updateAllAutoExperiments()}setForcedFeatures(e){this._options.forcedFeatureValues=e,this._render()}async setURL(e){if(e!==this._options.url){if(this._options.url=e,this._redirectedUrl="",this._options.remoteEval){await this._refreshForRemoteEval(),this._updateAllAutoExperiments(!0);return}this._updateAllAutoExperiments(!0)}}getAttributes(){return{...this._options.attributes,...this._options.attributeOverrides}}getForcedVariations(){return this._options.forcedVariations||{}}getForcedFeatures(){return this._options.forcedFeatureValues||new Map}getStickyBucketAssignmentDocs(){return this._options.stickyBucketAssignmentDocs||{}}getUrl(){return this._options.url||""}getFeatures(){return this._options.features||{}}getExperiments(){return this._options.experiments||[]}getCompletedChangeIds(){return Array.from(this._completedChangeIds)}subscribe(e){return this._subscriptions.add(e),()=>{this._subscriptions.delete(e)}}async _refreshForRemoteEval(){if(!this._options.remoteEval||!this._initialized)return;let e=await this._refresh({allowStale:!1});e.data&&await this.setPayload(e.data)}getAllResults(){return new Map(this._assigned)}onDestroy(e){this._destroyCallbacks.push(e)}isDestroyed(){return!!this._destroyed}destroy(e){var t;e=e||{},this._destroyed=!0,this._destroyCallbacks.forEach(e=>{try{e()}catch(e){console.error(e)}}),this._subscriptions.clear(),this._assigned.clear(),this._trackedExperiments.clear(),this._completedChangeIds.clear(),this._deferredTrackingCalls.clear(),this._trackedFeatures={},this._destroyCallbacks=[],this._payload=void 0,this._saveStickyBucketAssignmentDoc=void 0,t=this,X.forEach(e=>e.delete(t)),e.destroyAllStreams&&eb(),this.logs=[],eq&&window._growthbook===this&&delete window._growthbook,this._activeAutoExperiments.forEach(e=>{e.undo()}),this._activeAutoExperiments.clear(),this._triggeredExpKeys.clear()}setRenderer(e){this._renderer=e}forceVariation(e,t){if(this._options.forcedVariations=this._options.forcedVariations||{},this._options.forcedVariations[e]=t,this._options.remoteEval)return void this._refreshForRemoteEval();this._updateAllAutoExperiments(),this._render()}run(e){let{result:t}=eT(e,null,this._getEvalContext());return this._onExperimentEval(e,t),t}triggerExperiment(e){return(this._triggeredExpKeys.add(e),this._options.experiments)?this._options.experiments.filter(t=>t.key===e).map(e=>this._runAutoExperiment(e)).filter(e=>null!==e):null}triggerAutoExperiments(){this._autoExperimentsAllowed=!0,this._updateAllAutoExperiments(!0)}_getEvalContext(){return{user:this._getUserContext(),global:this._getGlobalContext(),stack:{evaluatedFeatures:new Set}}}_getUserContext(){return{attributes:this._options.user?{...this._options.user,...this._options.attributes}:this._options.attributes,enableDevMode:this._options.enableDevMode,blockedChangeIds:this._options.blockedChangeIds,stickyBucketAssignmentDocs:this._options.stickyBucketAssignmentDocs,url:this._getContextUrl(),forcedVariations:this._options.forcedVariations,forcedFeatureValues:this._options.forcedFeatureValues,attributeOverrides:this._options.attributeOverrides,saveStickyBucketAssignmentDoc:this._saveStickyBucketAssignmentDoc,trackingCallback:this._options.trackingCallback,onFeatureUsage:this._options.onFeatureUsage,devLogs:this.logs,trackedExperiments:this._trackedExperiments,trackedFeatureUsage:this._trackedFeatures}}_getGlobalContext(){return{features:this._options.features,experiments:this._options.experiments,log:this.log,enabled:this._options.enabled,qaMode:this._options.qaMode,savedGroups:this._options.savedGroups,groups:this._options.groups,overrides:this._options.overrides,onExperimentEval:this._onExperimentEval,recordChangeId:this._recordChangedId,saveDeferredTrack:this._saveDeferredTrack,eventLogger:this._options.eventLogger}}_runAutoExperiment(e,t){let r,i,s=this._activeAutoExperiments.get(e);if(e.manual&&!this._triggeredExpKeys.has(e.key)&&!s)return null;this._isAutoExperimentBlockedByContext(e)?r=eN(this._getEvalContext(),e,-1,!1,""):({result:r,trackingCall:i}=eT(e,null,this._getEvalContext()),this._onExperimentEval(e,r));let n=JSON.stringify(r.value);if(!t&&r.inExperiment&&s&&s.valueHash===n)return r;if(s&&this._undoActiveAutoExperiment(e),r.inExperiment){let t=G(e);if("redirect"===t&&r.value.urlRedirect&&e.urlPatterns){let t=e.persistQueryString?function(e,t){let r,i;try{r=new URL(e),i=new URL(t)}catch(e){return console.error(`Unable to merge query strings: ${e}`),t}return r.searchParams.forEach((e,t)=>{i.searchParams.has(t)||i.searchParams.set(t,e)}),i.toString()}(this._getContextUrl(),r.value.urlRedirect):r.value.urlRedirect;if(P(t,e.urlPatterns))return this.log("Skipping redirect because original URL matches redirect URL",{id:e.key}),r;this._redirectedUrl=t;let{navigate:s,delay:n}=this._getNavigateFunction();if(s)if(eq)Promise.all([...i?[z(i,this._options.maxNavigateDelay??1e3)]:[],new Promise(e=>window.setTimeout(e,this._options.navigateDelay??n))]).then(()=>{try{s(t)}catch(e){console.error(e)}});else try{s(t)}catch(e){console.error(e)}}else if("visual"===t){let t=this._options.applyDomChangesCallback?this._options.applyDomChangesCallback(r.value):this._applyDOMChanges(r.value);t&&this._activeAutoExperiments.set(e,{undo:t,valueHash:n})}}return r}_undoActiveAutoExperiment(e){let t=this._activeAutoExperiments.get(e);t&&(t.undo(),this._activeAutoExperiments.delete(e))}_updateAllAutoExperiments(e){if(!this._autoExperimentsAllowed)return;let t=this._options.experiments||[],r=new Set(t);for(let i of(this._activeAutoExperiments.forEach((e,t)=>{r.has(t)||(e.undo(),this._activeAutoExperiments.delete(t))}),t)){let t=this._runAutoExperiment(i,e);if(t&&t.inExperiment&&"redirect"===G(i))break}}_onExperimentEval(e,t){let r=this._assigned.get(e.key);this._assigned.set(e.key,{experiment:e,result:t}),this._subscriptions.size>0&&this._fireSubscriptions(e,t,r)}_fireSubscriptions(e,t,r){r&&r.result.inExperiment===t.inExperiment&&r.result.variationId===t.variationId||this._subscriptions.forEach(r=>{try{r(e,t)}catch(e){console.error(e)}})}_recordChangedId(e){this._completedChangeIds.add(e)}isOn(e){return this.evalFeature(e).on}isOff(e){return this.evalFeature(e).off}getFeatureValue(e,t){let r=this.evalFeature(e).value;return null===r?t:r}feature(e){return this.evalFeature(e)}evalFeature(e){return eV(e,this._getEvalContext())}log(e,t){this.debug&&(this._options.log?this._options.log(e,t):console.log(e,t))}getDeferredTrackingCalls(){return Array.from(this._deferredTrackingCalls.values())}setDeferredTrackingCalls(e){this._deferredTrackingCalls=new Map(e.filter(e=>e&&e.experiment&&e.result).map(e=>[eH(e.experiment,e.result),e]))}async fireDeferredTrackingCalls(){if(!this._options.trackingCallback)return;let e=[];this._deferredTrackingCalls.forEach(t=>{t&&t.experiment&&t.result?e.push(this._options.trackingCallback(t.experiment,t.result)):console.error("Invalid deferred tracking call",{call:t})}),this._deferredTrackingCalls.clear(),await Promise.all(e)}setTrackingCallback(e){this._options.trackingCallback=e,this.fireDeferredTrackingCalls()}setEventLogger(e){this._options.eventLogger=e}async logEvent(e,t){if(this._destroyed)return void console.error("Cannot log event to destroyed GrowthBook instance");if(this._options.enableDevMode&&this.logs.push({eventName:e,properties:t,timestamp:Date.now().toString(),logType:"event"}),this._options.eventLogger)try{await this._options.eventLogger(e,t||{},this._getUserContext())}catch(e){console.error(e)}else console.error("No event logger configured")}_saveDeferredTrack(e){this._deferredTrackingCalls.set(eH(e.experiment,e.result),e)}_getContextUrl(){return this._options.url||(eq?window.location.href:"")}_isAutoExperimentBlockedByContext(e){let t=G(e);if("visual"===t){if(this._options.disableVisualExperiments||this._options.disableJsInjection&&e.variations.some(e=>e.js))return!0}else{if("redirect"!==t||this._options.disableUrlRedirectExperiments)return!0;try{let t=new URL(this._getContextUrl());for(let r of e.variations){if(!r||!r.urlRedirect)continue;let e=new URL(r.urlRedirect);if(this._options.disableCrossOriginUrlRedirectExperiments&&(e.protocol!==t.protocol||e.host!==t.host))return!0}}catch(t){return this.log("Error parsing current or redirect URL",{id:e.key,error:t}),!0}}return!!(e.changeId&&(this._options.blockedChangeIds||[]).includes(e.changeId))}getRedirectUrl(){return this._redirectedUrl}_getNavigateFunction(){return this._options.navigate?{navigate:this._options.navigate,delay:0}:eq?{navigate:e=>{window.location.replace(e)},delay:100}:{navigate:null,delay:0}}_applyDOMChanges(e){if(!eq)return;let t=[];if(e.css){let r=document.createElement("style");r.innerHTML=e.css,document.head.appendChild(r),t.push(()=>r.remove())}if(e.js){let r=document.createElement("script");r.innerHTML=e.js,this._options.jsInjectionNonce&&(r.nonce=this._options.jsInjectionNonce),document.head.appendChild(r),t.push(()=>r.remove())}return e.domMutations&&e.domMutations.forEach(e=>{t.push(R.declarative(e).revert)}),()=>{t.forEach(e=>e())}}async refreshStickyBuckets(e){if(this._options.stickyBucketService){let t=this._getEvalContext(),r=await eP(t,this._options.stickyBucketService,e);this._options.stickyBucketAssignmentDocs=r}}generateStickyBucketAssignmentDocsSync(e,t){if(!("getAllAssignmentsSync"in e))return void console.error("generating StickyBucketAssignmentDocs docs requires StickyBucketServiceSync");let r=eK(this._getEvalContext(),t);return e.getAllAssignmentsSync(r)}inDevMode(){return!!this._options.enableDevMode}}var ez=r(2115);let eZ=ez.createContext({});function eQ(e,t){return(function(){let{growthbook:e}=ez.useContext(eZ);if(!e)throw Error("Missing or invalid GrowthBookProvider");return e})().getFeatureValue(e,t)}let eX=({children:e,growthbook:t})=>{let[r,i]=ez.useState(0);return ez.useEffect(()=>{if(t&&t.setRenderer)return t.setRenderer(()=>{i(e=>e+1)}),()=>{t.setRenderer(()=>{})}},[t]),ez.createElement(eZ.Provider,{value:{growthbook:t}},e)}}}]);